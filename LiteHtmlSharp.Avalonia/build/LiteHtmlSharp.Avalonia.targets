<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <ItemGroup>
    <!-- Use RID-specific filename wildcards to match native libraries -->
    <!-- This will match files like: LiteHtmlLib-win-x64.dll, liblitehtml-osx-arm64.dylib, etc. -->
    <_LiteHtmlSharpNativeLibrary Include="$(_LiteHtmlSharpNativePath)*-$(RuntimeIdentifier).*" Condition="'$(RuntimeIdentifier)' != ''" />

    <!-- For cross-platform builds without specific RID, include all libraries -->
    <_LiteHtmlSharpNativeLibrary Include="$(_LiteHtmlSharpNativePath)*.*" Condition="'$(RuntimeIdentifier)' == ''" />
  </ItemGroup>

  <Target Name="CopyLiteHtmlSharpNativeLibraries"
          AfterTargets="Build"
          Condition="'@(_LiteHtmlSharpNativeLibrary)' != ''">
    <Message Importance="High" Text="Copying LiteHtmlSharp native libraries for $(RuntimeIdentifier) from $(_LiteHtmlSharpNativePath)" />

    <!-- Copy to platform-specific output subdirectory -->
    <Copy SourceFiles="@(_LiteHtmlSharpNativeLibrary)"
          DestinationFolder="$(OutputPath)$(RuntimeIdentifier)"
          SkipUnchangedFiles="true"
          Condition="'$(RuntimeIdentifier)' != ''" />

    <!-- For cross-platform builds, copy all to output root -->
    <Copy SourceFiles="@(_LiteHtmlSharpNativeLibrary)"
          DestinationFolder="$(OutputPath)"
          SkipUnchangedFiles="true"
          Condition="'$(RuntimeIdentifier)' == ''" />

    <Message Importance="High" Text="Copied @(_LiteHtmlSharpNativeLibrary->Count()) native library file(s)" />
  </Target>

</Project>
